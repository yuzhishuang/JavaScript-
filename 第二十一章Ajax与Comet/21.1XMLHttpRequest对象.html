<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script type="text/javascript">
//  Ajax技术的核心是XMLHttpRequest对象
//  能够以异步方式从服务器取得更多信息，意味着用户单机后，可以不必刷新页面也能取得新数据

//  XMLHttpRequest对象
//  适用于IE7之前的版本
function createXHR () {
	if (typeof arguments.callee.activeXString != "string") {
		var versions = ["MSXML2.XMLHttp.6.0", "MSXML2.XMLHttp.3.0", "MSXML2.XMLHttp"],
			i, len;
		for (i = 0, len = versions.length; i < len; i++) {
			try {
				new ActiveXObject(versions[i]);
				arguments.callee.activeXString = versions[i];
				break;
			} catch (ex) {
				//  跳过
			}
		}
	}
	return new ActiveXObject(arguments.callee.activeXString);
}

//  如果你必须还要支持IE的早期版本，那么可以在这个createXHR()函数中加入对原生XHR对象的支持
function createXHR () {
	if (typeof XMLHttpRequest != "undefined") {
		return new XMLHttpRequest();
	} else if (typeof ActiveXObject != "undefined") {
		if (typeof arguments.callee.activeXString != "string") {
			var versions = ["MSXML2.XMLHttp.6.0", "MSXML2.XMLHttp.3.0", "MSXML2.XMLHttp"],
				i, len;
			for (i = 0, len = versions.length; i < len; i++) {
				try {
					new ActiveXObject(versions[i]);
					arguments.callee.activeXString = versions[i];
					break;
				} catch (ex) {
					//  跳过
				}
			}
		}
	} else {
		throw new Error("No XHR object available.");
	}
}


//  XHR的用法
//  在使用XHR对象时，要调用的第一个方法是open(),它接受3个参数：要发送的请求的类型（“get”、“post”等）、请求的URL和表示是否异步发送请求的布尔值。
//  调用open()方法并不会真正发送请求，而只是启动一个请求以备发送
//  只能向同一个域中使用相同端口和协议的URL发送请求
var xhr = createXHR();
xhr.open("get", "example.php", false);

//  要发送特定的请求，必须像下面这样调用send()方法
//  这里的send()方法接收一个参数，即要作为请求主体发送的数据。如果不需要通过请求主体发送数据，则必须传入null，因为这个参数对有些浏览器来说是必须的。
//  调用send()之后，请求就会被分派到服务器。
xhr.send(null);

//  由于这次请求是同步的，JavaScript代码会等到服务器响应之后再继续执行。在收到响应后，响应的数据会自动填充XHR对象的属性
//  responseText: 作为响应主体被返回的文本
//  responseXML: 如果响应的内容类型是“text/xml”或“application/xml”,这个属性中将保存包含着响应数据的XML DOM文档
//  status: 响应的HTTP状态

//  第一步是检查status属性，以确定响应已经成功返回。一般来说，可以将HTTP状态代码为200作为成功的标志。
//  此外状态代码为304表示请求的资源并没有被修改，可以直接使用浏览器中缓存的版本；当然，意味着响应是有效的。
//  为确保接收到适当的响应，应该像下面这样检查上述这两种状态代码
if ((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304) {
	alert(xhr.responseText);
} else {
	alert("Request was unsuccessful:" + xhr.status);
}

//  可以检测XHR对象的readyState属性，该属性表示请求/响应过程的当前活动阶段。这个属性可取的值如下
//  0、未初始化。尚未调用open()方法
//  1、启动。已经调用open()方法，但尚未调用send()方法
//  2、发送。已经调用send()方法，但尚未接收到响应
//  3、接收。已经接收到部分响应数据。
//  4、完成。已经接收到全部响应数据，而且已经可以在客户端使用了
//  只要readyState属性的值由一个值变成另一个值，都会触发一次readystatechange事件。
//  必须在调用open()之前指定onreadystatechange事件处理程序才能确保跨浏览器兼容性
var xhr = createXHR();
xhr.onreadystatechange = function () {
	if (xhr.readyState == 4) {
		if ((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304) {
			alert(xhr.responseText);
		} else {
			alert("Request was unsuccessful:" + xhr.status);
		}
	}
};
xhr.open("get", "example.txt", true);
xhr.send(null);



//  21.1.2HTTP头部信息
//  



</script>
</body>
</html>